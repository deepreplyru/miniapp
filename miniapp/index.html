<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ü—Ä–æ–±–Ω—ã–π —É—Ä–æ–∫ ‚Äî Mini App</title>
  <style>
    :root {
      --bg: #0f1115;
      --card: #151922;
      --text: #e7eef7;
      --muted: #99a3b3;
      --brand: #00c16a;
      --accent: #2d6cff;
      --danger: #ff4d4f;
      --border: #232a36;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg); color: var(--text);
    }
    .wrap { max-width: 780px; margin: 0 auto; padding: 16px; }
    .card {
      background: var(--card); border: 1px solid var(--border);
      border-radius: 16px; padding: 16px 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    h1 { font-size: 20px; margin: 0 0 8px; }
    p { margin: 8px 0; color: var(--muted); line-height: 1.45; }
    .row { display: grid; grid-template-columns: 1fr; gap: 12px; }
    .btn {
      display: inline-flex; align-items: center; justify-content: center;
      gap: 10px; padding: 12px 14px; border-radius: 12px; border: 1px solid var(--border);
      background: #1a1f2a; color: var(--text); text-decoration: none; cursor: pointer;
      font-weight: 600; transition: .15s ease-in-out; width: 100%;
    }
    .btn:hover { filter: brightness(1.08); }
    .btn.brand { background: var(--brand); border-color: var(--brand); color: #09110c; }
    .btn.accent { background: var(--accent); border-color: var(--accent); }
    .btn.ghost { background: transparent; }
    .btn.secondary { background:#0f1320; }
    .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .tag { font-size: 12px; color: #bfc8d8; background:#0e1220; border:1px solid var(--border); padding:4px 8px; border-radius: 999px; display:inline-block; }
    .divider { height: 1px; background: var(--border); margin: 12px 0; }
    .hidden { display: none !important; }
    .progress {
      height: 10px; background: #0e1220; border: 1px solid var(--border);
      border-radius: 999px; overflow: hidden;
    }
    .progress > i { display: block; height: 100%; width: 0%; background: linear-gradient(90deg,#2d6cff,#00c16a); }
    .list { margin: 8px 0 0; padding-left: 18px; color: var(--muted); }
    .kpi { display:flex; gap:10px; flex-wrap:wrap; }
    .kpi b { color: var(--text); }
    .pill {
      border:1px solid var(--border); background:#0f1320; padding:8px 10px; border-radius:12px; font-size:13px; color:var(--muted);
    }
    .footer-note { margin-top: 8px; font-size: 12px; color: #8fa2bd; }
    .ok { color:#00c16a; }
    .warn { color:#ffb020; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="screen-intro">
      <h1>–ü—Ä–æ–±–Ω—ã–π —É—Ä–æ–∫ (30 –º–∏–Ω)</h1>
      <p>–ë–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –°—Ä–∞–∑—É –ø—Ä–∞–∫—Ç–∏–∫–∞: –ª–µ–∫—Å–∏–∫–∞ ‚Üí –º–∏–Ω–∏-–¥–∏–∞–ª–æ–≥ ‚Üí —Ñ–∏–¥–±–µ–∫. –í –∫–æ–Ω—Ü–µ ‚Äî –æ—Ç—á—ë—Ç –∏ –ø–æ–∫—É–ø–∫–∞ –∫—É—Ä—Å–∞.</p>
      <div class="kpi">
        <span class="pill">üéØ –¶–µ–ª—å: –∑–∞–≥–æ–≤–æ—Ä–∏—Ç—å —É–≤–µ—Ä–µ–Ω–Ω–æ</span>
        <span class="pill">‚è±Ô∏è 30 –º–∏–Ω</span>
        <span class="pill">üó£Ô∏è –ì–æ–ª–æ—Å ‚Äî –≤ –ø—Ä–æ–¥–ª–µ–Ω–∏–∏</span>
      </div>
      <div class="divider"></div>
      <div class="row">
        <button class="btn brand" id="btn-start">–ù–∞—á–∞—Ç—å —É—Ä–æ–∫</button>
        <div class="grid2">
          <button class="btn secondary" id="btn-extend">–ü—Ä–æ–¥–ª–∏—Ç—å +30 –º–∏–Ω (250 ‚ÇΩ)</button>
          <button class="btn ghost" id="btn-open-chat">–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç –±–æ—Ç–∞</button>
        </div>
      </div>
      <p class="footer-note">–°–æ–≤–µ—Ç: –ø—Ä–æ–π–¥–∏ 6 —à–∞–≥–æ–≤ ‚Äî —É–≤–∏–¥–∏—à—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –æ—Ñ—Ñ–µ—Ä —Å–æ —Å–∫–∏–¥–∫–æ–π.</p>
    </div>

    <div class="card hidden" id="screen-lesson">
      <h1 id="step-title">–®–∞–≥ 1 –∏–∑ 8 ‚Äî –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ</h1>
      <div class="progress" aria-label="–ø—Ä–æ–≥—Ä–µ—Å—Å"><i id="bar"></i></div>
      <p id="step-text">–°–∫–∞–∂–∏ –ø–æ-–∞–Ω–≥–ª–∏–π—Å–∫–∏, –∫–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç: <i>‚ÄúMy name is ‚Ä¶‚Äù</i></p>
      <ul class="list" id="tips">
        <li>–ü–æ–¥—Å–∫–∞–∑–∫–∞: –ø—Ä–æ–∏–∑–Ω–æ—Å–∏ —è—Å–Ω–æ, —É–¥–∞—Ä–µ–Ω–∏–µ –Ω–∞ <i>name</i>.</li>
      </ul>
      <div class="divider"></div>
      <div class="grid2">
        <button class="btn" id="btn-prev">–ù–∞–∑–∞–¥</button>
        <button class="btn accent" id="btn-next">–î–∞–ª–µ–µ</button>
      </div>
      <div id="upsell" class="hidden" style="margin-top:10px">
        <button class="btn secondary" id="btn-extend-inline">üî• –ü—Ä–æ–¥–ª–∏—Ç—å —É—Ä–æ–∫ +30 –º–∏–Ω –∑–∞ 250 ‚ÇΩ (–≥–æ–ª–æ—Å)</button>
      </div>
    </div>

    <div class="card hidden" id="screen-summary">
      <h1>–ò—Ç–æ–≥–∏ –ø—Ä–æ–±–Ω–æ–≥–æ</h1>
      <p id="res-brief">–ó–∞ 30 –º–∏–Ω: –≤—ã—É—á–µ–Ω–æ 10 —Å–ª–æ–≤, –º–∏–Ω–∏-–¥–∏–∞–ª–æ–≥, –∏—Å–ø—Ä–∞–≤–∏–ª–∏ 3 –æ—à–∏–±–∫–∏ –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏—è. –£–∂–µ ~5% –ø—É—Ç–∏.</p>
      <div class="divider"></div>
      <div class="row">
        <button class="btn brand" id="btn-buy18">‚úÖ –ö—É–ø–∏—Ç—å 18 —É—Ä–æ–∫–æ–≤ ‚Äî 15 000 ‚ÇΩ</button>
        <button class="btn" id="btn-buy8">üìó –ö—É–ø–∏—Ç—å 8 —É—Ä–æ–∫–æ–≤</button>
        <button class="btn ghost" id="btn-ask">–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å</button>
      </div>
      <p class="footer-note">–ü–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ –Ω–∞—á–Ω—ë—à—å —É—Ä–æ–∫ 1 —Å—Ä–∞–∑—É –∏–ª–∏ –≤—ã–±–µ—Ä–µ—à—å –≤—Ä–µ–º—è.</p>
    </div>

    <div class="card hidden" id="screen-offtg">
      <h1>–û—Ç–∫—Ä–æ–π –≤ Telegram</h1>
      <p>–≠—Ç–æ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è Telegram. –û—Ç–∫—Ä–æ–π –≤ —á–∞—Ç–µ —Å –±–æ—Ç–æ–º.</p>
      <button class="btn accent" id="btn-open-tg">–û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞</button>
    </div>
  </div>

  <script>
    // === –ù–ê–°–¢–†–û–ô–ö–ò ===
    const BOT_USERNAME = (new URLSearchParams(location.search).get('bot')) || 'SpeakFlow_bot'; // ‚Üê –ü–û–î–ú–ï–ù–ò
    const LINKS = {
      extend: `https://t.me/${BOT_USERNAME}?start=extend`,
      buy18:  `https://t.me/${BOT_USERNAME}?start=buy18`,
      buy8:   `https://t.me/${BOT_USERNAME}?start=buy8`,
      ask:    `https://t.me/${BOT_USERNAME}?start=ask`,
      bot:    `https://t.me/${BOT_USERNAME}`
    };

    const isTelegram = typeof window.Telegram !== 'undefined' && Telegram.WebApp;
    if (isTelegram) {
      try {
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        Telegram.WebApp.setHeaderColor('secondary_bg_color');
        Telegram.WebApp.MainButton.hide();
      } catch(e) { /* ignore */ }
    }

    // === –≠–ö–†–ê–ù–´ ===
    const $intro   = document.getElementById('screen-intro');
    const $lesson  = document.getElementById('screen-lesson');
    const $summary = document.getElementById('screen-summary');
    const $offtg   = document.getElementById('screen-offtg');

    function show(el) {
      [$intro,$lesson,$summary,$offtg].forEach(x => x.classList.add('hidden'));
      el.classList.remove('hidden');
    }

    // –ï—Å–ª–∏ –Ω–µ –≤ Telegram ‚Äî –ø–æ–∫–∞–∂–µ–º —ç–∫—Ä–∞–Ω-–ø–æ–¥—Å–∫–∞–∑–∫—É
    if (!isTelegram) {
      show($offtg);
    }

    // === –£–†–û–ö (8 —à–∞–≥–æ–≤) ===
    const steps = [
      { t: '–®–∞–≥ 1 –∏–∑ 8 ‚Äî –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ',  d: '–°–∫–∞–∂–∏ –ø–æ-–∞–Ω–≥–ª–∏–π—Å–∫–∏: ‚ÄúMy name is ‚Ä¶‚Äù', tips:['–£–¥–∞—Ä–µ–Ω–∏–µ –Ω–∞ name.','–ë–µ–∑ –∞—Ä—Ç–∏–∫–ª—è –ø–µ—Ä–µ–¥ –∏–º–µ–Ω–µ–º.'] },
      { t: '–®–∞–≥ 2 ‚Äî –æ—Ç–∫—É–¥–∞ —Ç—ã',       d: '–°–∫–∞–∂–∏: ‚ÄúI am from ‚Ä¶‚Äù',                tips:['–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ: I\'m from ‚Ä¶'] },
      { t: '–®–∞–≥ 3 ‚Äî —Ä–∞–±–æ—Ç–∞',          d: '‚ÄúI work as a ‚Ä¶‚Äù',                     tips:['as a + –¥–æ–ª–∂–Ω–æ—Å—Ç—å.'] },
      { t: '–®–∞–≥ 4 ‚Äî small talk',      d: '–°–ø—Ä–æ—Å–∏: ‚ÄúHow are you today?‚Äù',        tips:['–ò–Ω—Ç–æ–Ω–∞—Ü–∏—è –≤–≤–µ—Ä—Ö –≤ –≤–æ–ø—Ä–æ—Å–µ.'] },
      { t: '–®–∞–≥ 5 ‚Äî –æ—Ç–≤–µ—Ç',           d: '–û—Ç–≤–µ—Ç—å: ‚ÄúI\'m fine, thanks.‚Äù',        tips:['–ù–µ ¬´I am good¬ª –¥–ª—è —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ.'] },
      { t: '–®–∞–≥ 6 ‚Äî –º–∏–Ω–∏-–¥–∏–∞–ª–æ–≥',     d: '–°–æ–±–µ—Ä–∏ –¥–∏–∞–ª–æ–≥ –∏–∑ 3 —Ñ—Ä–∞–∑',             tips:['–ö–æ—Ä–æ—Ç–∫–∏–µ —Ñ—Ä–∞–∑—ã ‚Äî –æ–∫.'] },
      { t: '–®–∞–≥ 7 ‚Äî –ø—Ä–æ–≥—Ä–µ—Å—Å',        d: '–í—ã—É—á–µ–Ω–æ 10 —Å–ª–æ–≤. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ 3 –æ—à–∏–±–∫–∏.', tips:['–£–∂–µ ~5% –±–∞–∑–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è.'] },
      { t: '–®–∞–≥ 8 ‚Äî –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ',     d: '–ü–æ–≤—Ç–æ—Ä–∏ –∫–ª—é—á–µ–≤—ã–µ —Ñ—Ä–∞–∑—ã.',             tips:['–ì–æ–≤–æ—Ä–∏ –≤—Å–ª—É—Ö ‚Äî –ª—É—á—à–µ –∑–∞–ø–æ–º–Ω–∏—à—å.'] },
    ];
    let idx = 0;

    const $title = document.getElementById('step-title');
    const $text  = document.getElementById('step-text');
    const $tips  = document.getElementById('tips');
    const $bar   = document.getElementById('bar');
    const $upsell= document.getElementById('upsell');

    function renderStep() {
      const s = steps[idx];
      $title.textContent = s.t;
      $text.innerHTML = s.d;
      $tips.innerHTML = s.tips.map(x => `<li>${x}</li>`).join('');
      const p = Math.round(((idx+1)/steps.length)*100);
      $bar.style.width = p+'%';
      // –ü–æ–∫–∞–∂–µ–º –∞–ø—Å–µ–ª–ª –ø—Ä–∏–º–µ—Ä–Ω–æ –ø–æ—Å–ª–µ —Å–µ—Ä–µ–¥–∏–Ω—ã (–ø–æ—Å–ª–µ —à–∞–≥–∞ 5)
      if (idx >= 5 && idx < steps.length-1) $upsell.classList.remove('hidden'); else $upsell.classList.add('hidden');

      // –ù–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º —à–∞–≥–µ ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –∏—Ç–æ–≥–æ–≤—ã–π —ç–∫—Ä–∞–Ω –ø–æ "–î–∞–ª–µ–µ"
      document.getElementById('btn-next').textContent = (idx === steps.length-1) ? '–ó–∞–≤–µ—Ä—à–∏—Ç—å' : '–î–∞–ª–µ–µ';
      // MainButton (–≤–Ω—É—Ç—Ä–∏ Telegram) ‚Äî –∫—É–ø–∏—Ç—å 18
      if (isTelegram) {
        if (idx >= steps.length-2) {
          Telegram.WebApp.MainButton.setText('–ö—É–ø–∏—Ç—å 18 —É—Ä–æ–∫–æ–≤ ‚Äî 15 000 ‚ÇΩ');
          Telegram.WebApp.MainButton.onClick(()=> openLink(LINKS.buy18));
          Telegram.WebApp.MainButton.show();
        } else {
          Telegram.WebApp.MainButton.hide();
        }
      }
    }

    // === –õ–ò–ù–ö–ò –í –¢–ì ===
    function openLink(url) {
      if (isTelegram) Telegram.WebApp.openTelegramLink(url);
      else window.open(url, '_blank', 'noopener');
    }

    // === –ö–ù–û–ü–ö–ò ===
    document.getElementById('btn-start').onclick = () => {
      if (!isTelegram) show($offtg);
      else { show($lesson); idx = 0; renderStep(); }
    };
    document.getElementById('btn-open-chat').onclick = () => openLink(LINKS.bot);
    document.getElementById('btn-extend').onclick = () => openLink(LINKS.extend);
    document.getElementById('btn-extend-inline').onclick = () => openLink(LINKS.extend);

    document.getElementById('btn-prev').onclick = () => {
      if (idx > 0) { idx--; renderStep(); }
      else show($intro);
    };
    document.getElementById('btn-next').onclick = () => {
      if (idx < steps.length-1) { idx++; renderStep(); }
      else {
        if (isTelegram) Telegram.WebApp.MainButton.hide();
        show($summary);
      }
    };

    document.getElementById('btn-buy18').onclick = () => openLink(LINKS.buy18);
    document.getElementById('btn-buy8').onclick  = () => openLink(LINKS.buy8);
    document.getElementById('btn-ask').onclick   = () => openLink(LINKS.ask);

    // –≠–∫—Ä–∞–Ω "–û—Ç–∫—Ä–æ–π –≤ Telegram"
    document.getElementById('btn-open-tg').onclick = () => openLink(LINKS.bot);

    // –ï—Å–ª–∏ –≤—Å—ë –∂–µ –æ—Ç–∫—Ä—ã—Ç–æ –≤ Telegram ‚Äî —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑–∞—Ç—å intro
    if (isTelegram) show($intro);
  </script>
</body>
</html>
